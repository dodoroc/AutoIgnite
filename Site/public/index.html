<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1">
    <link rel="icon" type="image/x-icon" href="data:,">
    <!-- <link rel="icon" href="data:image/gif;base64,R0lGODlhASABICAgIDs="> -->
    <title>AutoIgnite Dashboard</title>

    <style>
      :root {
        --clr-darkest:  hsl(0, 0%,  10%);
        --clr-darker:   hsl(0, 0%,  25%);
        --clr-dark:     hsl(0, 0%,  42%);
        --clr-median:   hsl(0, 0%,  50%);
        --clr-light:    hsl(0, 0%,  58%);
        --clr-lighter:  hsl(0, 0%,  75%);
        --clr-lightest: hsl(0, 0%,  90%);

        --clr-warn:     hsl(0, 100%, 53%);

        --font-size-h1: 1.476rem;
        --font-size-h2: 1.383rem;
        --font-size-h3: 1.296rem;
        --font-size-h4: 1.215rem;
        --font-size-h5: 1.138rem;
        --font-size-h6: 1.067rem;
        --font-size-rg: 1.000rem;
        --font-size-sm: 0.937rem;
        --font-size-xs: 0.878rem;

        --width-max: 1050px;

        --width-scrollbar: calc(100vw - 100%);
        --width-available: calc(100vw - (100vw - 100%));
      }

      @media (prefers-color-scheme: light) {
        :root {
        }
      }

      /*
      firebrick #b22222
      floralwhite #fffaf0
      ivory #fffff0
      maroon  #800000
      papayawhip  #ffefd5
      snow  #fffafa
      */

      html {
        overflow: hidden auto;
        overscroll-behavior: none;

        scrollbar-gutter: stable;
        scrollbar-width: thin;
        _scrollbar-color: var(--clr-median) var(--clr-darkest);
      }

      html, body {
        margin: 0;
        padding: 0;

        font: normal normal 14px/1.4 tahoma, arial, sans-serif;
      }

      *, *::before, *::after {
        box-sizing: inherit;
        font: inherit;
      }

      body {
        position: relative;
        box-sizing: border-box;
        overflow: hidden;


        max-width: var(--width-max);
        margin: 0 auto;

        display: flex;
        flex-direction: column;
        justify-content: flex-start;
        align-items: stretch;
        gap: 10px 0;
        padding: 5px;

        color: var(--clr-lighter);
        background: var(--clr-darkest);
        font-size: var(--font-size-rg);
      }

      h1 {
        margin: 0;
        padding: 0;
      }
      body > h1 {
        height: 2.1rem;
        line-height: 2.1rem;
        font-size: var(--font-size-h1);
      }

      button, input, textarea, select, datalist {
        color: var(--clr-darker);
        background-color: var(--clr-lighter);
        border: solid 1px var(--clr-lighter);
        outline: none;
        transition: 200ms linear;
        transition-property: border-color, background-color, color;
      }
      button, input:is([type="button"], [type="submit"], [type="clear"]) {
        text-align: center;
        cursor: pointer;
      }
      button:active, input:is([type="button"], [type="submit"], [type="clear"]):active {
        color: var(--clr-darkest);
        background-color: var(--clr-lightest);
        border-color: var(--clr-lightest);
      }
      :is(:not(button, input[type="button"], [type="checkbox"], [type="radio"])):focus {
        background-color: var(--clr-lightest);
        border-color: var(--clr-lightest);
      }
      input:is([type="checkbox"], [type="radio"]) {
        appearance: none;
        transform: scale(1);
        zoom: 1;

        width: 16px;
        height: 16px;
        margin: 0;
        padding: 0;
        outline: solid 1px var(--clr-lighter);
        outline-offset: -1px;
        border: solid 4px transparent;
        vertical-align: text-bottom;

        color: var(--clr-lighter);
        background-color: transparent;
        background-clip: content-box;
      }

      input:is([type="checkbox"], [type="radio"]):enabled {
        cursor: pointer;
      }
      input:is([type="checkbox"], [type="radio"]):disabled {
        background-color: var(--clr-median) !important;
      }
      input:is([type="checkbox"], [type="radio"]):checked:not(:disabled) {
        background-color: var(--clr-lighter);
      }

      input[type="radio"] {
        border-radius: 50%;
      }

      label:has([type="checkbox"], [type="radio"]) {
        column-gap: 0.8ch;
      }
      label:has(+ [type="checkbox"], + [type="radio"]) {
        margin-right: 0.8ch;
      }
      input:is([type="checkbox"], [type="radio"]) + label {
        margin-left: 0.8ch;
      }



      input:is([type="text"], [type="date"]),
      button,
      select {
        height: 28px;
        line-height: 28px;
        padding: 0 5px;
      }
      label {
        display: inline-flex;
        align-items: center;
        height: 28px;
        line-height: 28px;
      }

      /*
      select {
        appearance: none;

        background-image: conic-gradient(from 180deg at 50% 99%, #0000 145deg, currentColor 145deg, currentColor 215deg, #0000 215deg);
        background-position: calc(100% - 1px) calc(50% + 1px);
        background-size: 12px 9px;
        background-origin: content-box;
        background-repeat: no-repeat;
      }
      */



      form.aute {
        display: grid;
        grid-template: auto auto / auto min-content;
        gap: 5px;
      }

      form.aute select[name="filter-seriesid"] {
        grid-column: 1 / -1;
      }

      form.aute label {
        white-space: nowrap;
      }


      table {
        overflow: hidden;
        padding: 0;
        margin: 0;

        border-spacing: 2px;
        border-collapse: collapse;
        empty-cells: show;
      }

      table thead td {
        font-weight: 800;
        color: var(--clr-lightest);
        line-height: 23px;
        height: 23px;
        text-underline-offset: 2.5px;
        text-decoration: underline var(--clr-median);
      }

      table td {
        margin: 0;
        padding: 0 5px;
        white-space: nowrap;
        overflow: hidden;

        font-size: 13px;
        line-height: 21px;
        height: 21px;
        color: var(--clr-light);
        border: 1px solid var(--clr-darker);
      }

      table tbody tr:hover td {
        color: var(--clr-lightest);
        color: antiquewhite;
      }

      table .nm { width: 100% }
      table .ao { width: auto }
      table .wo { width: auto }
      table .sk { width: auto }
      table tr td:last-of-type { text-align: right }


      table td[colspan] {
        text-align: center;
      }

      #spinner {
        display: grid;
        height: calc(100dvh - 10px);
        place-content: center;

        font-size: clamp(24px, 9dvmin, 56px);
        color: #0000;

        background: no-repeat radial-gradient(var(--clr-lighter) 0px, var(--clr-darker) 100px, var(--clr-darkest) 250px);
        background-clip: text;
        background-size: 80cqmin 80cqmin;
        background-position: 50% 50%;
        filter: blur(1.5px);

        animation: 1s infinite spinner;
      }
      @keyframes spinner {
          0% { background-position: calc(50% +  80.0px) calc(50% +   0.0px) }
          5% { background-position: calc(50% +  76.1px) calc(50% +  24.7px) }
         10% { background-position: calc(50% +  64.7px) calc(50% +  47.0px) }
         15% { background-position: calc(50% +  47.0px) calc(50% +  64.7px) }
         20% { background-position: calc(50% +  24.7px) calc(50% +  76.1px) }
         25% { background-position: calc(50% +   0.0px) calc(50% +  80.0px) }
         30% { background-position: calc(50% + -24.7px) calc(50% +  76.1px) }
         35% { background-position: calc(50% + -47.0px) calc(50% +  64.7px) }
         40% { background-position: calc(50% + -64.7px) calc(50% +  47.0px) }
         45% { background-position: calc(50% + -76.1px) calc(50% +  24.7px) }
         50% { background-position: calc(50% + -80.0px) calc(50% +   0.0px) }
         55% { background-position: calc(50% + -76.1px) calc(50% + -24.7px) }
         60% { background-position: calc(50% + -64.7px) calc(50% + -47.0px) }
         65% { background-position: calc(50% + -47.0px) calc(50% + -64.7px) }
         70% { background-position: calc(50% + -24.7px) calc(50% + -76.1px) }
         75% { background-position: calc(50% +  -0.0px) calc(50% + -80.0px) }
         80% { background-position: calc(50% +  24.7px) calc(50% + -76.1px) }
         85% { background-position: calc(50% +  47.0px) calc(50% + -64.7px) }
         90% { background-position: calc(50% +  64.7px) calc(50% + -47.0px) }
         95% { background-position: calc(50% +  76.1px) calc(50% + -24.7px) }
        100% { background-position: calc(50% +  80.0px) calc(50% +   0.0px) }
      }

      [cloak] > :not(#spinner) {
        display: none;
      }
      :not([cloak]) > #spinner {
        display: none !important;
      }
/*
  let x,y,p, str = '';
  let A = Math.PI / 180 * 18;
  for (let i = 0; i <= 20; i++) {
    x = 80 * Math.cos(i*A);
    y = 80 * Math.sin(i*A);
    x = new String(x.toFixed(1)).padStart(5, ' ');
    y = new String(y.toFixed(1)).padStart(5, ' ');
    p = new String(i*5).padStart(3, ' ');
    str += `  ${p}% { background-position: calc(50% + ${x}px) calc(50% + ${y}px) }\n`;
  }
  console.log(str);
*/
    </style>

    <script type="module" src="/assets/app.mjs"></script>
  </head>
  <body @vue:mounted="mounted" cloak>

    <h1>AutoIgnite Dashboard</h1>

    <form class="aute" id="aute-filters" @submit.prevent @input="filterParamsChanged">
      <select name="filter-seriesid" v-model="model.source.seriesId">
        <option v-for="series in model.source.series" :value="series.seriesId">
          {{series.name}} ({{series.releaseYear}})
        </option>
      </select>
      <input type="text" placeholder="Filter by program name" maxlength="50" spellcheck="false" autocorrect="off"
        name="filter-name"
        v-model="model.filter.params.name"
      >
      <label><input type="checkbox" name="filter-unwatched" v-model="model.filter.params.unwatched"> Unwatched only</label>
      <!-- <label><input type="radio" name="filter-x"> xxxxxxx</label> -->
    </form>

    <table class="aute" id="aute-results">
      <colgroup><col class="nm"><col class="ao"><col class="wo"><col class="sk"></colgroup>

      <thead>
        <tr><td>Name</td><td>Aired On</td><td>Watched</td><td>Key</td></tr>
      </thead>

      <tbody v-if="model.filter.results.length">
        <tr v-for="program in model.filter.results" :key="model.source.seriesId+'-'+program.seepKey">
          <td>{{program.name}}</td>
          <td>{{program.airedOn}}</td>
          <td>{{program.watchedOn}}</td>
          <td>{{seep(program.seepKey)}}</td>
        </tr>
      </tbody>

      <tbody v-else>
        <tr><td colspan="10">Nothing to show</td></tr>
      </tbody>
    </table>

    <div id="spinner">LOADING</div>

  </body>
</html>
